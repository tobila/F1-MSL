<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Formula 1 Visualizations</title>

    <!-- Bootstrap -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="styles.css" rel="stylesheet">
</head>

<body data-spy="scroll" data-target=".navbar" data-offset="50">
    <nav class="navbar navbar-dark bg-dark">
      <span class="navbar-brand">Formula 1 Visualizations</span>
    </nav>

    <br><br>


    <div class="container">

      <div class="card text-center">
        <div class="card-header">
          Lap-Times (Main-View)
        </div>
        <div id="mainView">
          <!-- <img src="img/3d-linechart.png"> -->
        </div>
      </div>

      <!-- <br><br>

      <div class="card text-center">
        <div class="card-header">
          Parameter-Settings (Parameter-View)
        </div>
        <div class="card-body">
          <div class="form-row">
            <div class="form-group col-md-4">
              <label for="customRange3">Year Range</label>
              <input type="range" class="custom-range" min="0" max="5" step="0.5" id="customRange3">
            </div>
            <div class="form-group col-md-1">
              &nbsp;
            </div>
            <div class="form-group col-md-4">
              <label for="inputState">Race</label>
              <select id="inputState" class="form-control">
                <option selected>Choose...</option>
                <option>...</option>
              </select>
            </div>
            <div class="form-group col-md-1">
              &nbsp;
            </div>
            <div class="form-group col-md-2">
              <label for="inputZip">Year</label>
              <select id="inputState" class="form-control">
                <option selected>Choose...</option>
                <option>...</option>
              </select>
            </div>
          </div>
        </div>
      </div> -->

      <br><br>

      <div class="card text-center">
        <div class="card-header" id="detailsHeader">
          Details for Race Monaco 1979 (Details-on-Demand-View)
        </div>
        <div class="card-body" id="detailsView">
          <h5 class="card-title">Fisher-Yates Shuffle</h5>
          <img src="img/fisher-yates-shuffle1.png">
          <img src="img/fisher-yates-shuffle2.png">
          <br><hr><br>
          <h5 class="card-title">Lap-Times Linechart</h5>
          <img src="img/linechart.png">
        </div>
      </div>

    </div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js" integrity="sha384-pjaaA8dDz/5BgdFUPX6M/9SUZv4d12SUPF0axWc+VRZkx5xU3daN+lYb49+Ax+Tl" crossorigin="anonymous"></script>






    <script>
      $.get('/fastestLapsHeatmap', {}, function(data){
        var xValues = data.year;
        var yValues = data.raceNames;
        var zValues = data.fastestLaps;

        // console.log(yValues.length);
        // console.log(xValues.length);
        var laptimesPlot = document.getElementById('mainView');



        var colorscaleValue = [
          [0, '#4D9603'],
          [1, '#E6FBA0']
        ];

        var data = [{
          x: xValues,
          y: yValues,
          z: zValues,
          type: 'heatmap',
          zmin:65000,
          zmax:120000,
          colorscale: colorscaleValue,
          showscale: true
        }];

        var layout = {
          title: 'Fastest Laptimes in Milliseconds',
          autosize: true,
          // width: 500,
          height: 1000,
          xaxis: {
            ticks: '',
            side: 'top'
          },
          yaxis: {
            automargin: true
          }
        };



        Plotly.newPlot('mainView', data, layout);

        laptimesPlot.on('plotly_click', function(data){
          var clickData = data.points[0];
          var getYear = clickData.pointIndex[1];
          var getRace = clickData.pointIndex[0];

          var race = yValues[getRace];
          var year = xValues[getYear];


          $.get('/getDetailsViewData', {raceIndex: getRace, yearIndex: getYear}, function(data){
            var detailsHeader = document.getElementById("detailsHeader");

            // HIER FUNKTIOSAUFRUF FISHER-YATESSHUFFLE:
            // Sortiertes Startarray: data.start
            // Vermischtes Endarray: data.end

            detailsHeader.innerHTML = "Details for Race "+race+" "+year;
            window.location.href = "index.html#detailsHeader";
          });

        });
      });
    </script>


    <script>
      $.get('/testData', {}, function(data){
        console.log(data)
      });
    </script>


<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var n = 200,
    array = d3.shuffle(d3.range(n)),
    actions = mergesort(array.slice()).reverse();

var margin = {top: 180, right: 40, bottom: 180, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var y = d3.scale.ordinal()
    .domain([1, 0])
    .rangeRoundBands([height, 0], .3);

var x = d3.scale.ordinal()
    .domain(d3.range(n))
    .rangePoints([0, width]);

var a = d3.scale.linear()
    .domain([0, n - 1])
    .range([-45, 45]);

var svg = d3.select("#detailsView").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var line = svg.append("g")
    .attr("class", "line")
  .selectAll("line")
    .data(array.map(function(v, i) {
      return {
        value: v,
        index: i,
        array: 0
      };
    }))
  .enter().append("line")
    .attr("transform", transform)
    .attr("y2", -y.rangeBand());

var line0 = line[0],
    line1 = new Array(n);

var transition = d3.transition()
    .duration(75)
    .each("start", function start() {
      var action = actions.pop();
      switch (action.type) {
        case "copy": {
          var i = action[0],
              j = action[1],
              e = line1[j] = line0[i],
              d = e.__data__;
          d.index = j;
          d.array = (d.array + 1) & 1;
          transition.each(function() { d3.select(e).transition().attr("transform", transform); });
          break;
        }
        case "swap": {
          var t = line0;
          line0 = line1;
          line1 = t;
          break;
        }
      }
      if (actions.length) transition = transition.transition().each("start", start);
    });

function transform(d) {
  return "translate(" + x(d.index) + "," + y(d.array) + ")rotate(" + a(d.value) + ")";
}

function mergesort(array) {
  var actions = [],
      n = array.length,
      array0 = array,
      array1 = new Array(n);

  for (var m = 1; m < n; m <<= 1) {
    for (var i = 0; i < n; i += (m << 1)) {
      merge(i, Math.min(i + m, n), Math.min(i + (m << 1), n));
    }
    actions.push({type: "swap"});
    array = array0, array0 = array1, array1 = array;
  }

  function merge(left, right, end) {
    for (var i0 = left, i1 = right, j = left; j < end; ++j) {
      if (i0 < right && (i1 >= end || array0[i0] <= array0[i1])) {
        array1[j] = array0[i0];
        actions.push({type: "copy", "0": i0++, "1": j});
      } else {
        array1[j] = array0[i1];
        actions.push({type: "copy", "0": i1++, "1": j});
      }
    }
  }

  return actions;
}

</script>

</body>

</html>
